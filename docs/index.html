<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pocket book apps manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
        .issue {
            margin-bottom: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
    
        .issue-header {
            background-color: #f0f0f0;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
    
        .issue-comments {
            padding: 20px;
        }
    
        .issue-body {
            background-color: #f9f9f9;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
        }
    
        .comment {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #f9f9f9;
        }
    </style>        
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
        crossorigin="anonymous"></script>
    <div class="mt-5 container border border-top-0">
        <h1 class="text-center">Pocket book apps manager <i class="bi bi-book"></i></h1>
        <p class="text-center">This app is an unofficial app manager for PocketBook e-readers. It allows you to download
            unofficial pocketbook apps</p>
        <hr>
        <div class="row">
            <div class="col-md-6">
                <h2>Installation</h2>
                <p>
                    To install the application, connect your e-reader to your computer via a cable and copy the
                    app-manager.app
                    from <a href="https://github.com/CatInBeard/pb-apps/releases" id="release_link">release.zip</a> to
                    the applications folder. On Linux, you can build the
                    application from source using the command make build and automatically install it on the connected
                    e-reader
                    using the command make install.
                </p>
            </div>
            <div class="col-md-6">
                <h2>Source code and contribute</h2>
                <p>
                    You can get app manager source code on <a href="https://github.com/CatInBeard/pb-apps">github</a>.
                    You can add your own pb app. To do this you need to copy <a
                        href="https://github.com/CatInBeard/pb-apps/blob/main/Makefile">Makefile</a> and <a
                        href="https://github.com/CatInBeard/pb-apps/blob/main/.github/workflows/uploadOnRelease.yml">.github/workflows/uploadOnRelease.yml</a>
                    in your repo and create a release. Next you need to clone <a
                        href="https://github.com/CatInBeard/pb-apps">this</a> repo, add your app to <a
                        href="https://github.com/CatInBeard/pb-apps/blob/main/repo.json">repo.json</a> and make a pull
                    request. After pull request accepted, your app can be downloaded by app manager
                </p>
            </div>
        </div>
        <hr>
        <h2 class="text-center">FAQ <i class="bi bi-question-circle"></i></h2>
        <div class="row">
            <div class="col-md-6">
                <h3>Q: How to install the app installer on PocketBook?</h3>
                <p>A: To install the application, connect your e-reader to your computer via a cable and copy the
                    release file to the applications folder. On Linux, you can build the application from source using
                    the command make build and automatically install it on the connected e-reader using the command make
                    install.</p>
            </div>
            <div class="col-md-6">
                <h3>Q: What are the risks of using unofficial apps?</h3>
                <p>A: Using unofficial apps can pose risks to your e-reader, including deleting important system files
                    or settings, changing system configuration, installing unverified or malicious software, and
                    accessing sensitive information or settings.</p>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <h3>Q: How to update the app installer to the latest version?</h3>
                <p>A: The app installer supports self-update. If the self-update is successful, you will have the latest
                    version of the app installer. If the self-update fails, you can update the app installer manually by
                    connecting your e-reader to your computer via a cable and copying the new release file to the
                    applications folder, replacing the existing file.</p>
            </div>
            <div class="col-md-6">
                <h3>Q: How to update the app installer to the latest version?</h3>
                <p>A: The app installer supports self-update. If the self-update is successful, you will have the latest
                    version of the app installer. If the self-update fails, you can update the app installer manually by
                    connecting your e-reader to your computer via a cable and copying the new release file to the
                    applications folder, replacing the existing file.</p>
            </div>
        </div>
        
        <div class="text-center">
            <h3>Still have questions?</h3>
            <p>Feel free to ask <a href="https://github.com/CatInBeard/pb-apps/issues">here</a></p>
        </div>
        
        <div id="issues-container" class="d-none"></div>

        <script>
            async function getIssues(owner, repo) {
                try {
                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/issues?state=all`);
        
                    if (!response.ok) {
                        throw new Error(`Failed to use github api: ${response.status} ${response.statusText}`);
                    }
        
                    const issues = await response.json();
        
                    const issuesContainer = document.getElementById('issues-container');
        
                    let hasIssues = false;
        
                    issues.forEach(issue => {
                        if (issue.pull_request === undefined) {
                            hasIssues = true;
        
                            const issueElement = document.createElement('div');
                            issueElement.className = 'issue';
        
                            const issueHeader = document.createElement('div');
                            issueHeader.className = 'issue-header';
                            issueHeader.innerHTML = `
                                <h4>${issue.title}</h4>
                                <p>Opened by ${issue.user.login} on ${new Date(issue.created_at).toLocaleString()}</p>
                            `;
                            issueElement.appendChild(issueHeader);
        
                            const issueComments = document.createElement('div');
                            issueComments.className = 'issue-comments';
        
                            const issueBody = document.createElement('div');
                            issueBody.className = 'issue-body';
                            issueBody.innerHTML = `
                                <p>${issue.body}</p>
                            `;
                            issueComments.appendChild(issueBody);
        
                            getComments(issue.comments_url, issueComments);
        
                            issueElement.appendChild(issueComments);
        
                            issuesContainer.appendChild(issueElement);
                        }
                    });
        
                    if (hasIssues) {
                        issuesContainer.classList.remove('d-none');
                        issuesHeader.remove("d-none");
                    } else {
                        issuesContainer.innerHTML = '<p>No issues found.</p>';
                    }
                } catch (error) {
                    console.error(error);
                }
            }
        
            async function getComments(url, container) {
                try {
                    const response = await fetch(url);
                    const comments = await response.json();
        
                    comments.forEach(comment => {
                        const commentElement = document.createElement('div');
                        commentElement.className = 'comment';
                        commentElement.innerHTML = `
                            <p>${comment.body}</p>
                            <p>Commented by ${comment.user.login} on ${new Date(comment.created_at).toLocaleString()}</p>
                        `;
                        container.appendChild(commentElement);
                    });
                } catch (error) {
                    console.error(error);
                }
            }
        
            getIssues("CatInBeard", "pb-apps");
        </script>

        <script>
            async function getLatestReleaseZipUrl(owner, repo) {
                try {
                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/releases/latest`);

                    if (!response.ok) {
                        throw new Error(`Failed to use github api: ${response.status} ${response.statusText}`);
                    }

                    const release = await response.json();

                    const zipAsset = release.assets.find(asset => asset.name.endsWith('.zip'));

                    if (!zipAsset) {
                        console.log('release.zip not found');
                        return null;
                    }

                    const zipUrl = zipAsset.browser_download_url;
                    return zipUrl;

                } catch (error) {
                    console.error(error);
                    return null;
                }
            }

            window.onload = () => {
                getLatestReleaseZipUrl("CatInBeard", "pb-apps")
                    .then(zipUrl => {
                        if (zipUrl) {
                            release_link.href = zipUrl
                        }
                    });
            }

        </script>
    </div>
</body>

</html>